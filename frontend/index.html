<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scalaye=1" name="viewport">
    <meta charset="UTF-8">
    <script>
        var url = location.origin + location.href.replace(location.origin, '').substr(0, location.href.replace(location.origin, '').lastIndexOf('/'));
    </script>
    <title>Payables by Tulsi</title>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" id="bootstrap-css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css" rel="stylesheet">

    <link crossorigin="anonymous" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato|Poppins|Roboto|Roboto+Mono|Rubik|Work+Sans&display=swap"
        rel="stylesheet" />

    <link href="css/style.css" rel="stylesheet">
    <link href="css/videostyle.css" rel="stylesheet">
    <link href="css/select2.css" rel="stylesheet">
</head>

<style>
    label {
        display: flex !important;
    }
    .select2-container--open .select2-dropdown--below {
        width: 345px;
    }
    .select2-selection.select2-selection--multiple {
        width: 344px;
        max-height: 280px !important;
        height: 66px;
        background: #fcfcfc;
        border: 1px solid #3333;
    }
    .select2-container--default .select2-selection--multiple .select2-selection__choice {
        background-color: #ffffff;
        border: 1px solid #aaa;
        border-radius: 4px;
        display: inline-block;
        margin-left: 5px;
        margin-top: 5px;
        padding: 4px;
    }
 .dropbtn {
  background-color: #ffffff;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
  cursor: pointer;
}

.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
    display: none;
    position: absolute;
    right: 0;
    background-color: #ffffff;
    min-width: 160px;
    box-shadow: 1px 8px 16px 0px rgba(179, 179, 179, 0.2);
    z-index: 1;
    border-bottom-left-radius: 5px;
    border-bottom-right-radius: 5px;
    margin: 4%;
    margin-top: 0;    
}

.dropdown-content a {
    color: #737373;
    padding: 17px 16px;
    text-decoration: none;
    display: block;
    border-bottom: 1px solid #d4d4d499;
    font-family: lato;
    font-size: 15px;
    text-align: center;
}

.dropdown-content a:hover {background-color: #f1f1f1;}

.dropdown:hover .dropdown-content {
  display: block;
    width: 242px;
}

.dropdown:hover .dropbtn {
    text-align: center;
}   
    
.message_notify {
    font-size: 15px;
    border: 2px solid #616161;
    border-radius: 5px;
    color: #6d6b6b;
    height: 39px;
    max-height: 51px;
    background: #e9e9e9;
    overflow: hidden;
    font-family: sans-serif;
    margin-bottom: 2%;
    box-shadow: 0px 0px 12px #c4c4c46b;
    font-weight: 400;
    padding: 10px;
}    
    
.message_notify a {
    background: #616161;
    color: #ffffff !important;
    padding: 17px;
    margin-left: -16px;
    margin-right: 13px;
    text-transform: uppercase;
    font-weight: 700;
} 
</style>

<body>

    <div id="loading">
        <img id="loading-image" src="img/axiloader.gif" alt="Loading..." />
    </div>

    <!-- video modal -->
    <section class="video-modal">

        <!-- Modal Content Wrapper -->
        <div id="video-modal-content" class="video-modal-content">

            <!-- iframe -->
            <iframe id="youtube" width="100%" height="100%" frameborder="0" allow="autoplay" allowfullscreen
                src=></iframe>

            <a href="#" class="close-video-modal">
                <!-- X close video icon -->
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0"
                    y="0" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve" width="24"
                    height="24">

                    <g id="icon-x-close">
                        <path fill="#ffffff"
                            d="M30.3448276,31.4576271 C29.9059965,31.4572473 29.4852797,31.2855701 29.1751724,30.980339 L0.485517241,2.77694915 C-0.122171278,2.13584324 -0.104240278,1.13679247 0.52607603,0.517159487 C1.15639234,-0.102473494 2.17266813,-0.120100579 2.82482759,0.477288136 L31.5144828,28.680678 C31.9872448,29.1460053 32.1285698,29.8453523 31.8726333,30.4529866 C31.6166968,31.0606209 31.0138299,31.4570487 30.3448276,31.4576271 Z"
                            id="Shape"></path>
                        <path fill="#ffffff"
                            d="M1.65517241,31.4576271 C0.986170142,31.4570487 0.383303157,31.0606209 0.127366673,30.4529866 C-0.12856981,29.8453523 0.0127551942,29.1460053 0.485517241,28.680678 L29.1751724,0.477288136 C29.8273319,-0.120100579 30.8436077,-0.102473494 31.473924,0.517159487 C32.1042403,1.13679247 32.1221713,2.13584324 31.5144828,2.77694915 L2.82482759,30.980339 C2.51472031,31.2855701 2.09400353,31.4572473 1.65517241,31.4576271 Z"
                            id="Shape"></path>
                    </g>

                </svg>
            </a>

        </div><!-- end modal content wrapper -->


        <!-- clickable overlay element -->
        <div class="overlay"></div>


    </section>
    <!-- end video modal -->


    <nav class="navbar navbar-default navbar-fixed-top" role="navigation"
        style="padding: 0 15px;background-color: #ffffff;">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse"
                type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#"><img src="img/logo7.png" style="width: 45%;" /></a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <!--            <li class="active"><a href="#">Link</a></li>-->
                <!--            <li><a href="#">Link</a></li>-->
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://www.youtube.com/watch?v=Ahglrb_z7wQ" data-youtube-id="Ahglrb_z7wQ"
                        class=" button primary js-trigger-video-modal">
                        <i class="fas fa-graduation-cap"></i> &nbsp; Learn how to use
                    </a>
                </li>

                <li>
                    <a href="mailto:tulsihelpdesk@gmail.com" target="_blank" >
                     Feedback</a>
                </li>

                <li class="dropdown">
                  <a class="dropbtn"><span id="userimage"><img src="img/Profilepic.webp" style="max-height: 40px; border-radius: 50%;" /> &nbsp; </span><span id="username">Not LoggedIn</span> &nbsp; <i class="fas fa-angle-down"></i></a>
                  <div class="dropdown-content" >
                  <a href="/pricing" onclick="GotoPricing();"><span id="signout">Manage Subscription</span></a>
                   <a href="mailto:tulsihelpdesk@gmail.com" target="_blank" >Report a bug</a>
                   <a href="www.google.com" target="_blank" >Helpdesk</a>
                  <a href="#" style="background: #f88da5; color: #fff; font-weight: 700;" onclick="SignOutFirebase();"><span id="signout">Logout</span> &nbsp; <i class="fas fa-sign-out-alt"></i></a>
                  </div>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>
    <div style="border-right: 1px solid #a4a4a4;margin-top: 50px;">
        <div
            style="padding: 2% 2% 2% 2%; border-bottom: 1px solid #e9e9e9; background: linear-gradient(176deg, #f9f9f9, transparent);">
            <div style="display: inline-flex; width:100%; margin-top: 1%;">
                <h3 style="width: 100%;margin: 0;line-height: 2;font-weight: 600;font-family: initial;color: #999;">
                    Payment Accounts
                    <p style="
    font-size: 13px;
    font-weight: 100;
">These below are your payment sources to manage payables &amp; recieveables from &amp; in each source</p>
                </h3>
                <div
                    style="color: #607D8B; place-self: center; min-width: 282px; text-align: center; font-weight: 300; font-size: 21px;text-align: right;">
                    <i class="far fa-calendar-alt" style="color: #e5e5e5; font-size: 63px;"></i> &nbsp; <a
                        style="display: inline-block; text-align: left;color: #999;"><b id="today"
                            style="font-weight:900;">-----</b><br>
                        <b id="date">------</b></a>
                </div>
            </div>

             <h5 class="message_notify" style="margin-left: 0;"> <a><i class="fas fa-info-circle"></i> &nbsp; HACK:</a>Shift transactions between payment sources. Total holdings should be used to see how long all the balances stack up against all your transactions until you get cashflow negetive.<b href="#">know more tips</b>
             </h5> 
            <div class="tab" id="tabs-accounts">
                <button class="tablinks" data-accid="defaultOpen" id="defaultOpen" onclick="openTab(event, 'All')"
                    style="background: repeating-linear-gradient(379deg, #fff6dc, #ffffff17 155px);border-color: #ffb200;">
                    <i class="fas fa-university" style="background: #ffb202;"></i><br><b style="color: #ffb202;">Total of All Holdings</b>
                    <input disabled placeholder="---------" style="text-align: center;border: none;font-weight: 700;"
                        type="number" />
                </button>
                <!--ACCOUNT TABS APPEND HERE-->
                <button class="tablinks" data-accid="add-account" id="add-account"
                    onclick="$(this).addClass('active');" style="filter: none;opacity: 1;color: #15a180;">
                    <i class="fas fa-plus"></i>
                    <b>Add new account</b>
                    <input id="account_title" placeholder="Bank name" type="text" />
                    <a onclick="addAccountActual()" placeholder="add" type="button" class="addbank">
                        Add
                        Bank Account
                    </a>
                </button>
            </div>
        </div>
    </div>
    <div class="tabcontent" id="All">
       <ul class="timeline balance_in_account_bar">
        <li class="timelinePart">
            <p class="timeline-date" style="background: linear-gradient(157deg, #efefef, #e0dede);
    color: #363636;
    border-top-left-radius: 34px;
    border-bottom-left-radius: 30px;
    text-align: center;
    padding: 6px 0px;
    margin-top: 13px;
    font-weight: 500;
    font-size: 16px;">
                QUERY
            </p>
        <div class="timeline-content" style="display: flex;padding-bottom: 2%; padding-top: 1%;">
           <div style="display: grid; width: 28%;">
           <label>Search</label>
            <input style="width: 97%;" class="balance_input" onkeyup="advance_search_record($(this).val())" placeholder="Search data within all transactions" type="text"/> 
           </div>
           <div style="display: grid; width: 45%;">
           <label>Filters</label>
            <b style="padding: 19px 0;
    margin-right: 2%;
    border-radius: 4px;
    border: 1px solid #3333;
    background: #fcfcfc;">
                <a style="color: #19c9a0; background: #ccfff3; border: 1px solid;font-weight: 700;padding: 12px;border-radius: 38px;margin: 1%;"
                   title="Cheques paid and are now deducted from your account">
                    <input class="1 clearchk" name="clearPaymentCheckbox" onchange="filterRecords()"
                           style="width: 27px; height: 20px; vertical-align: text-bottom;"
                           type="checkbox" checked
                           value="Cleared"> &nbsp; Cleared &nbsp; <i class="fas fa-check"></i>
                </a>
                <a style="color: #f46083; background: #ffeaef; border: 1px solid;font-weight: 700;padding: 12px;border-radius: 38px;margin: 1%;"
                   title="Cheques that is given out but arnt yet cleared from the bank.">
                    <input class="1" name="clearPaymentCheckbox" onchange="filterRecords()"
                           style="width: 27px; height: 20px; vertical-align: text-bottom;"
                           type="checkbox"
                           value="Un Clear"> &nbsp; Un-Clear &nbsp; <i class="fas fa-exclamation-circle"></i>
                </a>
                <a style="color: #fac200; background: #fffae8; border: 1px solid;font-weight: 700;padding: 12px;border-radius: 38px;margin: 1%;"
                   title="Cheques that are yet to be paid">
                    <input class="1" name="clearPaymentCheckbox" onchange="filterRecords()"
                           style="width: 27px; height: 20px; vertical-align: text-bottom;"
                           type="checkbox"
                           value="To Pay">&nbsp; To Pay &nbsp; <i class="fas fa-bell"></i>
                </a>
                <a style="color: #616161;background: #e4e4e4; border: 1px solid;font-weight: 700;padding: 12px;border-radius: 38px;margin: 1%;"
                   title="Cheques that have been dishonoured or failed to clear">
                    <input class="1" name="clearPaymentCheckbox" onchange="filterRecords()"
                           style="width: 27px; height: 20px; vertical-align: text-bottom;"
                           type="checkbox"
                           value="Bounced">&nbsp; Bounced &nbsp; <i class="fas fa-times"></i>
                </a>
            </b>
            </div>
            <div style="display: grid; width: 25%;">
            <label>Payment Collection Days</label>
            <select class="select selectpicker collectiondayselect collectionDays" multiple
                    onchange="filterbyCollectionDay($(this).val());" style="float: right; margin: -7px 11px;">
                <option>Monday</option>
                <option>Tuesday</option>
                <option>Wednesday</option>
                <option>Thursday</option>
                <option>Friday</option>
                <option>Saturday</option>
                <option>Sunday</option>
            </select>
            </div>
            <div style="float: right; margin: -7px 11px;clear: both;"><button onclick="exportToExcel_datapopulate();" id="export_to_excel_btn">Export to Excel</button></div>
        </div>
        </li>
        </ul>

    <ul class="timeline" id="all-transactions">
        <li class="timelinePart" id="add-entry-all">
            <p class="timeline-date" style="background: linear-gradient(157deg, #393939, #343434);
    color: #fff;
    border-top-left-radius: 34px;
    border-bottom-left-radius: 30px;
    text-align: center;
    padding: 6px 0px;
    margin-top: 13px;
    font-weight: 700;
    font-size: 16px;">
                + ADD NEW
            </p>
            <div class="timeline-content">
                <div class="responsive-table">
                    <table class="nowTable" id="t_draggable1">
                        <thead>
                            <tr class="ui-state-default">
                                <th>Date</th>
                                <th style="width: 10%;">Cheque no. (Optional)</th>
                                <th>Party Name</th>
                                <th>Party Type</th>
                                <th style="width: 12%;">Payment Source </th>
                                <th style="width: 10%;">Payment Status</th>
                                <th>Amount</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody class="t_sortable">
                            <tr id="all-transaction-fields">
                                <td><input id="transaction_date" class="mandatory-field" placeholder="DD/MM/YYYY"
                                        type="date"></td>
                                <td><input id="cheque_no" placeholder="cheque no." type="number"></td>
                                <td><input id="payee" placeholder="Name of Buyer or Supplier" class="mandatory-field" type="text"></td>
                                <td>
                                    <select class="form-control" id="mode" name="">
                                        <option disabled selected>Who're they ?</option>
                                        <option class="green-text" value="Buyer">Buyer</option>
                                        <option class="red-text" value="Supplier">Supplier</option>
                                    </select>
                                </td>
                                <td>
                                    <input id="transaction_id" type="hidden" value="">
                                    <select class="form-control" id="account-list">
                                        <option disabled selected>Paying from?</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="form-control" id="status" name="">
                                        <option disabled selected>Is it done?</option>
                                        <option class="red-text" value="Un Clear">Un-Clear</option>
                                        <option class="orange-text" value="To Pay">To Pay</option>
                                        <option class="green-text" value="Cleared">Cleared</option>
                                        <option class="black-text" value="Bounced">Bounced</option>
                                    </select>
                                </td>
                                <td class="balance">
                                    <input id="withdrawal" placeholder="enter amount" class="mandatory-field"
                                        type="number">
                                </td>
                                <td>
                                    <button id="add-transaction" onclick="addupdatetransaction(false);" type="button">
                                        <i class="fa fa-plus" style="opacity: 1;"> &nbsp; Add</i>
                                        <!--                                        Add-->
                                    </button>
                                    <button class="btn btn-info" id="edit-transaction"
                                        onclick="addupdatetransaction(true);" style="display: none;" type="button">
                                        <i class="fa fa-upload" style="opacity: 1;"> &nbsp; Update</i>
                                        <!--                                        Update-->
                                    </button>
                                    <button id="clear-transaction" onclick="clearTransactionFields();" type="button" style="background: #afafaf;">
                                        <i class="fas fa-minus-circle" style="opacity: 1;"> &nbsp; Clear</i>
                                        <!--                                        Clear-->
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </li>
        <!--TRANSACTION RECORDS HERE-->
    </ul>
    <span id="load-more" style="float: right; display: none; margin:20px;color:blue;cursor: pointer;"
        onclick="LoadMore();">Load more</span>
    </div>
<div id="export_to_excel" style="display:none">
    <table id="tblDatatoexport">
      <tr>
            <th>Date</th>
            <th>Check #</th>
            <th>Party Name</th>
            <th>Party Type</th>
            <th>Payment Source</th>
            <th>Payment Status</th>
            <th>Amount</th>
        </tr>
    </table>
</div>
    
    <input style="display: none;" id="customerid">
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js'></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-firestore.js"></script>
   
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js'></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>

    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-firestore.js"></script>

    <script defer src="js/mFirebase.js"></script>
    <script src="js/index.js"></script>
    <script src="js/select2.js"></script>
    <script src="js/videoscript.js"></script>

    <script>

        $(document).ready(function () {
            setTimeout(function(){ $('#clearchk').prop("checked",true).trigger("change");},5000);
            $("body").hide();
            $(".collectiondayselect").select2();
            getFirebaseConfig().then(function () {
                firebase.auth().onAuthStateChanged(function (user) {
                    if (user) {
                        UserObject = user;

                        $('#userimage').find('img').attr('src', UserObject.photoURL);
                        $('#username').text(UserObject.displayName);

                        tblUsers = db.collection("tbl_users");
                        tblUsers.where("UserID", "==", UserObject.uid).get().then(function (querySnapshot) {
                            if (querySnapshot.docs.length > 0) {
                                tblStripeCustomers = db.collection("tbl_stripecustomers");
                                tblStripeCustomers.where("UserID","==",UserObject.uid).where("CustomerEmail", "==", UserObject.email).get().then(function (querySnapshotNew) {
                                    if (querySnapshotNew.docs.length > 0) {
                                        $('#customerid').val(querySnapshotNew.docs[0].data().customerid);
                                        getCustomerSubscriptions().then(function (response) {

                                            if (response.length > 0) {
                                                if (response[0].status == "active" || response[0].status == "trialing") {
                                                } else {
                                                    location.href = url + "/pricing";
                                                }
                                            }

                                        });
                                    }
                                });

                            } else {
                                tblUsers.add({
                                    UserID: UserObject.uid,
                                    PaymentVerified: false,
                                    AmountPaid: 0,
                                    TransactionID: "",
                                    ExpiryDate: "",
                                    collectionDays: ""
                                }).then(function (docRef) {
                                    location.href = url + "/pricing";
                                }).catch(function (error) {
                                    console.error("Error adding document: ", error);
                                });
                            }
                        }).catch(function (error) {
                            console.error("Error adding document: ", error);
                        });
                        tblAccounts = db.collection("tbl_accounts");
                        tblAccounts.where("title", "==", 'Cash in Hand').where("UserID", "==", UserObject.uid).get().then(function (querySnapshot) {
                            // console.log(querySnapshot.docs.length);
                         
                            // console.log(querySnapshot.size);
                            if (querySnapshot.docs.length > 0) {
                                console.log('Cash in Hand already Exists');
                            } else {
                                console.log('Cash in Hand account is creating...');
                                addAccount({ title: "Cash in Hand", init_balance: 0, UserID: UserObject.uid });
                            }
                        }).catch(function (error) {
                            console.error("Error adding document: ", error);
                        });
                        getAccountsAll();
                        $("body").show();
                    } else {
                        location.href = url + "/signin";
                    }
                });
                BalanceInputField();
                $('.selectpicker').select2({
                    placeholder: 'Select Collection day'
                });
            });
        });

        function GotoPricing() {
            location.url = url + "/pricing";
        }

        function SignOutFirebase() {
            firebase.auth().signOut().then(function () {
                location.href = url + "/signin";
            }).catch(function (error) {
                // An error happened.
            });
        }
    </script>
</body>

<script>
    $(window).load(function () {
        $('#loading').hide();
    });
</script>

</html>
