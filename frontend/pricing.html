<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta charset="UTF-8">
    <script>
        var url = location.origin + location.href.replace(location.origin, '').substr(0, location.href.replace(location.origin, '').lastIndexOf('/'));
    </script>
    <title>Payables ~ Billing & Subscription</title>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css" rel="stylesheet">

    <link crossorigin="anonymous" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato|Poppins|Roboto|Roboto+Mono|Rubik|Work+Sans&display=swap"
        rel="stylesheet" />
    <link href="css/pricing.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/select2.css" rel="stylesheet">
</head>
<style>
    .disable-sub-btn{
        pointer-events: none;
        cursor: default;
        background: #c5c5c5;
    }  
.row:before, .row:after {
    display: none;
    content: " ";
}
</style>
<body>

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation"
        style="padding: 0 15px;background-color: #ffffff;">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse"
                type="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index"><img src="img/logo7.png" style="width: 45%;" /></a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <!--            <li class="active"><a href="#">Link</a></li>-->
                <!--            <li><a href="#">Link</a></li>-->
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="index">
                        <i class="fas fa-arrow-left"></i> &nbsp; Back to Dashboard
                    </a>
                </li>

                <li>
                    <a href="mailto:tulsihelpdesk@gmail.com" target="_blank" >
                     Feedback</a>
                </li>

                <li class="dropdown">
                  <a class="dropbtn" style="display: flex; height: 80px;"><span id="userimage"><img src="img/Profilepic.webp" style="max-width: 40px; border-radius: 50%;" /> &nbsp; </span><span id="username" style="margin-left: 12px; margin-right: 9px;">Not LoggedIn</span></a>
                  <div class="dropdown-content" >
                  <a href="pricing" onclick="GotoPricing();"><span id="signout">Manage Subscription</span></a>
                   <a href="mailto:tulsihelpdesk@gmail.com" target="_blank" >Report a bug</a>
                   <a href="www.google.com" target="_blank" >Helpdesk</a>
                  <a href="#" style="background: #f88da5; color: #fff; font-weight: 700;" onclick="SignOutFirebase();"><span id="signout">Logout</span> &nbsp; <i class="fas fa-sign-out-alt"></i></a>
                  </div>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>


    <div class="container" style="margin-top: 5%;">
        <div class="row">
            <div class="col-md-12">
                <h2 style="text-align:center">Current Subscription Details</h2>
                <p style="text-align:center">Keep a hold on your subscription with our automated process</p>
            </div>
        </div>
        <div class="row" style="margin-left: 48px;
    padding-bottom: 22px;
    margin-top: 26px;
    border: 1px solid #c9c8c7;
    box-shadow: 0 1px 21px 0 rgba(135,140,157,.2);
    border-radius: 7px;
    overflow: hidden;
    background: #ffffff url(../img/5ede8c01da0955caac532ece_scene_1.png) 101% 11% no-repeat;
    background-repeat: no-repeat;
    background-size: 68% 100%;
    background-position-x: 100%;
    background-position-y: 38%;
    margin: 1%;
    padding: 23px;
    background-color: #fafafa;
    font-weight: 700;
    font-size: 14px;">
            <div class="col-md-4" id="prev-subscription-details" style="display:none;padding: 0;">
                <ul style="line-height: 36px; font-family: monospace; list-style: none; padding: 0;color: #5c5c5c;">
                    <li> <i class="far fa-envelope-open"></i> &nbsp; Email: <span id="email">-</span></li>
                    <li><i class="fas fa-key"></i> &nbsp; UID: <span id="uid">-</span></li>
                    <li> <i class="fas fa-calculator"></i> &nbsp; Plan: <span id="plan">-</span></li>
                </ul>
            </div>
            <div class="col-md-4">
                <ul style="line-height: 36px; font-family: monospace; list-style: none; padding: 0;color: #5c5c5c;">
                    <li><i class="fas fa-dollar-sign"></i> &nbsp; Last payment: <span id="amtpaid">-</span></li>
                    <li><i class="far fa-calendar-check"></i> &nbsp; Last payment date: <span id="trandate">-</span>
                    </li>
                    <li><i class="far fa-calendar-times"></i> &nbsp; Plan Expiry Date: <span id="expdate">-</span></li>
                </ul>
            </div>
            <div class="col-md-4"></div>
        </div>
        <div class="row">
        <div class="row" style="margin-left: 48px;
    padding-bottom: 22px;
    margin-top: 26px;
    border: 1px solid #c9c8c7;
    box-shadow: 0 1px 21px 0 rgba(135,140,157,.2);
    border-radius: 7px;
    overflow: hidden;
    background: #6495ed url(../img/poweredbystripe.png);
    background-repeat: no-repeat;
    background-size: 9% 112%;
    background-position-x: 98%;
    background-position-y: 60%;
    margin: 2%;
    padding: 23px;
    background-color: cornflowerblue;
    font-weight: 700;
    font-size: 14px;
    border-left: 19px solid #3333;
    border-right: 19px solid #3333;">
<li style="list-style: none;" id="billingdetailLink">
<span id="customer-portal" style="cursor: pointer;" onclick="createCustomerPortalSession();"> 
 <a style="color: #005bff; background: #fffffff2; padding: 10px; border-radius: 6px; margin-right: 2%;">Billing Transactions &nbsp; <i class="fas fa-external-link-square-alt"></i></a>
 <a style="color: #005bff; background: #fffffff2; padding: 10px; border-radius: 6px; margin-right: 2%;">Upgrade Plan  &nbsp; <i class="fas fa-external-link-square-alt"></i></a>
 <a style="color: #005bff; background: #fffffff2; padding: 10px; border-radius: 6px; margin-right: 2%;">Manage Cards  &nbsp; <i class="fas fa-external-link-square-alt"></i></a>
 <a style="color: #005bff; background: #fffffff2; padding: 10px; border-radius: 6px; margin-right: 2%;">Cancel Subscription  &nbsp; <i class="fas fa-external-link-square-alt"></i></a>
</span>
</li>
        </div>
        </div>


        <div class="row">
            <div class="col-md-12">
                <h2 style="text-align:center">Simple Pricing</h2>
                <p style="text-align:center">We made it flexible for you to subscribe according to your business cashflow</p>
            </div>
        </div>

        <div class="row" style="display: grid; grid-gap: 16px; grid-template-columns: repeat(2, 1fr); margin-bottom: 5%; width: 85%; margin: auto; margin-top: 12%;">
            <div class="col-6" style="width: 100%;">
                <ul class="price">
                    <li class="header">Monthly Subscription</li>
                    <li class="grey">$ 10 / Month</li>
                    <ul class="price-box__list">
                        <li class="price-box__list-el"><b>Includes:</b></li>
                       <li class="price-box__list-el"><b>Unlimited</b> transactions</li>
                       <li class="price-box__list-el"><b>Unlimited</b> Payment Sources</li>
                       <li class="price-box__list-el">Team members (Comming Soon)</li>
                </ul>
                    <li class="grey"><a href="payment.html?package=1" class="subbtn button">Subscribe Monthly</a></li>
                  <div style=" font-size: 16px; margin-top: 10px; color: #7f7f7f;">
                    <i class="fas fa-lock" style="color: #00bb32;"></i> &nbsp;
                    <b>SSLSECURED PAYMENT</b>
                    <br>
                    <p>Your information is protected by 256-bit SSL encryption</p>
            </div>
              </ul>
            </div>

            <div class="col-6" style="width: 100%;">
                <ul class="price">
                    <li class="header">Yearly Subscription</li>
                    <li class="grey">$ 99 / year</li>
                    <ul class="price-box__list">
                        <li class="price-box__list-el"><b>Includes:</b></li>
                       <li class="price-box__list-el"><b>Unlimited</b> transactions</li>
                       <li class="price-box__list-el"><b>Unlimited</b> Payment Sources</li>
                       <li class="price-box__list-el">Team members (Comming Soon)</li>
                </ul>
                    <li class="grey"><a href="payment.html?package=2" class="subbtn button">Subscribe Yearly</a></li>
                  <div style=" font-size: 16px; margin-top: 10px; color: #7f7f7f;">
                    <i class="fas fa-lock" style="color: #00bb32;"></i> &nbsp;
                    <b>SSLSECURED PAYMENT</b>
                    <br>
                    <p>Your information is protected by 256-bit SSL encryption</p>
            </div>
                </ul>
            </div>
        </div>
    </div>
    <input style="display:none;" id="customerid" value="" />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js'></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-firestore.js"></script>

    <script defer src="js/mFirebase.js"></script>
    <script src="js/pricing.js"></script>
    <script src="script.js"></script>
    <script>
        var db, UserObject;
        function initializeFirebase1() {
            getFirebaseConfig().then(function () {
                var firebaseConfig = fireBaseConfigInfo;
                //initialize firebase
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);


                    db = firebase.firestore();
                }

                firebase.auth().onAuthStateChanged(function (user) {

                    if (user) {
                        UserObject = user;

                    
                tblUsers = db.collection("tbl_users");
                tblUsers.where("UserID", "==", UserObject.uid).get().then(function (resp) {
                    var respParsed = resp.docs[0].data();
                    $("#prev-subscription-details").show();
                    $("#email").html(UserObject.email);
                    $("#uid").html(UserObject.uid);
                    var plan = (respParsed.PackageID == 1 ? "$10/Month" : respParsed.PackageID == 2 ? "$25/3 Month" : respParsed.PackageID == 3 ? "$50/year" : "No package subscribed");
                    $("#plan").html(plan);
                    $("#amtpaid").html(respParsed.AmountPaid);
                    $("#expdate").html(respParsed.ExpiryDate.toDate().toLocaleDateString());
                    $("#trandate").html(respParsed.TransactionDate.toDate().toLocaleDateString());
                    tblStripeCustomers = db.collection("tbl_stripecustomers");
                    tblStripeCustomers.where("CustomerEmail", "==", UserObject.email).get().then(function (querySnapshot) {
                        if (querySnapshot.docs.length > 0) {
                            $('#customerid').val(querySnapshot.docs[0].data().customerid);
                            $("#billingdetailLink").show();
                            getCustomerSubscriptions().then(function (response){

                            if(response.length>0){
                                if(response[0].status=="active"){
                                    console.log(response[0]);
                                    $(".subbtn").addClass("disable-sub-btn");
                                    var plan = '$'+response[0].plan.amount/100+'/'+response[0].plan.interval;
                                    $("#plan").html(plan);
                                    $("#amtpaid").html('$'+response[0].plan.amount/100);
                                    $("#expdate").html(new Date(response[0].current_period_end*1000).toLocaleDateString());
                                    $("#trandate").html(new Date(response[0].current_period_start*1000).toLocaleDateString());
                                }else{
                                    $(".subbtn").removeClass("disable-sub-btn");
                                }
                            }

                            });
                        }
                    });

                    //$('.price .button').each(function (i,v) {
                    //    $(v).attr('href', $(v).attr('href').replace('<CUS_ID>', UserObject.uid));
                    //   console.log($(v).attr('href'));
                    //});
                });
            } else {
                        location.href = url + "/signin.html";
                    }
                });
            });
        
        }
        $(document).ready(function () {
            initializeFirebase1();

        });
    </script>
</body>

</html>
